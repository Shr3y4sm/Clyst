<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clyst - Profile</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../static/css/styles.css" />
    <link rel="stylesheet" href="../static/css/profile.css" />
  </head>
  <body>
    <!-- ===== NAVBAR ===== -->
    <nav id="topNav">
      <div class="nav">
        <div class="nav-left">
          <div class="hamburger" onclick="toggleMenu(event)">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path d="M3 4H21V6H3V4ZM3 11H21V13H3V11ZM3 18H21V20H3V18Z"></path>
            </svg>
          </div>
          <a
            href="{{ url_for('home') }}"
            style="text-decoration: none; color: inherit"
            >Clyst</a
          >
        </div>

        <div class="nav-center" id="navLinks">
          <a href="{{ url_for('home') }}">Community Feed</a>
          <a href="{{ url_for('products_page') }}">Marketplace</a>
          {% if current_user.is_authenticated %}
          <a href="{{ url_for('logout') }}">Logout</a>
          {% else %}
          <a href="{{ url_for('login') }}">Login</a>
          <a href="{{ url_for('register') }}">Register</a>
          {% endif %}
        </div>

        <div></div>
      </div>

      <div class="mobile-menu" id="mobileMenu">
        <a href="{{ url_for('home') }}">Community Feed</a>
        <a href="{{ url_for('products_page') }}">Marketplace</a>
        {% if current_user.is_authenticated %}
        <a href="{{ url_for('logout') }}">Logout</a>
        {% else %}
        <a href="{{ url_for('login') }}">Login</a>
        <a href="{{ url_for('register') }}">Register</a>
        {% endif %}
      </div>
    </nav>

    <div class="container">
      <!-- Main Content -->
      <div class="main-content">
        <!-- Profile Header -->
        <div class="profile-header">
          <div class="profile">
            <div class="profile-details">
              <div class="profile-avatar">
                {% if profile_user %} {{ profile_user.name[0].upper() }} {% else
                %} {{ current_user.name[0].upper() }} {% endif %}
              </div>
              <!-- Verification status or prompt -->
              {% if profile_user and profile_user.is_verified or (not
              profile_user and current_user.is_verified) %}
              <div class="profile-verify verified">
                <span
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M4 2H20C20.5523 2 21 2.44772 21 3V22.2763C21 22.5525 20.7761 22.7764 20.5 22.7764C20.4298 22.7764 20.3604 22.7615 20.2963 22.7329L12 19.0313L3.70373 22.7329C3.45155 22.8455 3.15591 22.7322 3.04339 22.4801C3.01478 22.4159 3 22.3465 3 22.2763V3C3 2.44772 3.44772 2 4 2ZM12 13.5L14.9389 15.0451L14.3776 11.7725L16.7553 9.45492L13.4695 8.97746L12 6L10.5305 8.97746L7.24472 9.45492L9.62236 11.7725L9.06107 15.0451L12 13.5Z"
                    ></path>
                  </svg>
                  Verified Artisan
                </span>
              </div>
              {% elif current_user.is_authenticated and (not profile_user or
              current_user.id == profile_user.id) %}
              <div class="btn promote-btn profile-verify">
                <span
                  ><a href="{{ url_for('verify_otp') }}"
                    >BECOME VERIFIED ARTISAN</a
                  ></span
                >
              </div>{% endif %} 
              {% if current_user.is_authenticated and (not profile_user or
              current_user.id == profile_user.id) %}
              <div
                class="btn promote-btn profile-verify"
                style="margin-left: 8px"
              >
                <span
                  ><a href="{{ url_for('orders_list') }}">MY ORDERS</a></span
                >
              </div>
              {% endif %}
              <h1 class="profile-name">
                {% if profile_user %} {{ profile_user.name }} {% else %} {{
                current_user.name }} {% endif %}
              </h1>

              <div class="profile-bio">
                {% if profile_user %} {% if profile_user.email %}
                <p>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M3 3H21C21.5523 3 22 3.44772 22 4V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V4C2 3.44772 2.44772 3 3 3ZM12.0606 11.6829L5.64722 6.2377L4.35278 7.7623L12.0731 14.3171L19.6544 7.75616L18.3456 6.24384L12.0606 11.6829Z"
                    ></path>
                  </svg>
                  {{ profile_user.email }}
                </p>
                {% endif %} {% if profile_user.phone %}
                <p>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M21 16.42V19.9561C21 20.4811 20.5941 20.9167 20.0705 20.9537C19.6331 20.9846 19.2763 21 19 21C10.1634 21 3 13.8366 3 5C3 4.72371 3.01545 4.36687 3.04635 3.9295C3.08337 3.40588 3.51894 3 4.04386 3H7.5801C7.83678 3 8.05176 3.19442 8.07753 3.4498C8.10067 3.67907 8.12218 3.86314 8.14207 4.00202C8.34435 5.41472 8.75753 6.75936 9.3487 8.00303C9.44359 8.20265 9.38171 8.44159 9.20185 8.57006L7.04355 10.1118C8.35752 13.1811 10.8189 15.6425 13.8882 16.9565L15.4271 14.8019C15.5572 14.6199 15.799 14.5573 16.001 14.6532C17.2446 15.2439 18.5891 15.6566 20.0016 15.8584C20.1396 15.8782 20.3225 15.8995 20.5502 15.9225C20.8056 15.9483 21 16.1633 21 16.42Z"
                    ></path>
                  </svg>
                  {{ profile_user.phone }}
                </p>
                {% endif %} {% if profile_user.location %}
                <p>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      d="M12 2c-4.41 0-8 3.59-8 8-.03 6.44 7.12 11.6 7.42 11.82.17.12.38.19.58.19s.41-.06.58-.19c.3-.22 7.45-5.37 7.42-11.82 0-4.41-3.59-8-8-8m0 12c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4"
                    ></path></svg
                  >{{ profile_user.location }}
                </p>
                {% endif %} {% else %} {% if current_user.email %}
                <p>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M3 3H21C21.5523 3 22 3.44772 22 4V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V4C2 3.44772 2.44772 3 3 3ZM12.0606 11.6829L5.64722 6.2377L4.35278 7.7623L12.0731 14.3171L19.6544 7.75616L18.3456 6.24384L12.0606 11.6829Z"
                    ></path>
                  </svg>
                  {{ current_user.email }}
                </p>
                {% endif %} {% if current_user.phone %}
                <p>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M21 16.42V19.9561C21 20.4811 20.5941 20.9167 20.0705 20.9537C19.6331 20.9846 19.2763 21 19 21C10.1634 21 3 13.8366 3 5C3 4.72371 3.01545 4.36687 3.04635 3.9295C3.08337 3.40588 3.51894 3 4.04386 3H7.5801C7.83678 3 8.05176 3.19442 8.07753 3.4498C8.10067 3.67907 8.12218 3.86314 8.14207 4.00202C8.34435 5.41472 8.75753 6.75936 9.3487 8.00303C9.44359 8.20265 9.38171 8.44159 9.20185 8.57006L7.04355 10.1118C8.35752 13.1811 10.8189 15.6425 13.8882 16.9565L15.4271 14.8019C15.5572 14.6199 15.799 14.5573 16.001 14.6532C17.2446 15.2439 18.5891 15.6566 20.0016 15.8584C20.1396 15.8782 20.3225 15.8995 20.5502 15.9225C20.8056 15.9483 21 16.1633 21 16.42Z"
                    ></path>
                  </svg>
                  {{ current_user.phone }}
                </p>
                {% endif %} {% if current_user.location %}
                <p>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      d="M12 2c-4.41 0-8 3.59-8 8-.03 6.44 7.12 11.6 7.42 11.82.17.12.38.19.58.19s.41-.06.58-.19c.3-.22 7.45-5.37 7.42-11.82 0-4.41-3.59-8-8-8m0 12c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4"
                    ></path>
                  </svg>
                  {{ current_user.location }}
                </p>
                {% endif %} {% endif %}
              </div>
            </div>

            <div class="profile-info">
              <div class="info-item">
                <div class="info-label">Posts</div>
                <div class="info-value">{{ posts|length }}</div>
              </div>
              <div class="info-item">
                <div class="info-label">Products</div>
                <div class="info-value">{{ products|length }}</div>
              </div>
              <div class="info-item">
                <div class="info-label">Joined on</div>
                <div class="info-value">
                  {% if profile_user %} {{ profile_user.created_at }} {% else %}
                  {{ current_user.created_at }} {% endif %}
                </div>
              </div>
            </div>
          </div>
          <!-- Portfolio Narrative Section -->
          {% if portfolio_narrative %}
          <div class="portfolio-narrative">
            <div class="narrative-header">
              <h3>
                About {{ profile_user.name if profile_user else
                current_user.name }}
              </h3>
              <button
                id="speakNarrative"
                class="say-aloud-btn"
                title="Listen to Artist Story"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="32"
                  height="32"
                  fill="#000000"
                  viewBox="0 0 256 256"
                >
                  <path
                    d="M168,32V224a8,8,0,0,1-12.91,6.31L85.25,176H40a16,16,0,0,1-16-16V96A16,16,0,0,1,40,80H85.25l69.84-54.31A8,8,0,0,1,168,32Zm32,64a8,8,0,0,0-8,8v48a8,8,0,0,0,16,0V104A8,8,0,0,0,200,96Zm32-16a8,8,0,0,0-8,8v80a8,8,0,0,0,16,0V88A8,8,0,0,0,232,80Z"
                  ></path>
                </svg>
              </button>
            </div>
            <p id="narrativeText">{{ portfolio_narrative }}</p>

            <div class="narrative-meta">
              <div class="narrative-stats">
                <div class="narrative-stat">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M5 11.1005L7 9.1005L12.5 14.6005L16 11.1005L19 14.1005V5H5V11.1005ZM4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM15.5 10C14.6716 10 14 9.32843 14 8.5C14 7.67157 14.6716 7 15.5 7C16.3284 7 17 7.67157 17 8.5C17 9.32843 16.3284 10 15.5 10Z"
                    ></path>
                  </svg>
                  <span>{{ posts|length }} Posts</span>
                </div>
                <div class="narrative-stat">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M12 1L21.5 6.5V17.5L12 23L2.5 17.5V6.5L12 1ZM4.5 7.65311V7.65788L12 12V20.689L19.5 16.3469V7.65311L12 3.311L4.5 7.65311Z"
                    ></path>
                  </svg>
                  <span>{{ products|length }} Products</span>
                </div>
                <div class="narrative-stat">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="100%"
                    height="100%"
                    viewBox="0 0 24 24"
                  >
                    <path
                      fill="currentColor"
                      d="M5 2h2v3H5zm4 0h2v3H9zm4 0h2v3h-2zm6 7h-2V8a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v10a3 3 0 0 0 3 3h8a3 3 0 0 0 3-3h2c1.103 0 2-.897 2-2v-5c0-1.103-.897-2-2-2zm-2 7v-5h2l.002 5H17z"
                    ></path>
                  </svg>
                  <span
                    >{{ (posts|length + products|length) }} Total Works</span
                  >
                </div>
              </div>
              <div class="narrative-stat">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M17.0007 1.20825 18.3195 3.68108 20.7923 4.99992 18.3195 6.31876 17.0007 8.79159 15.6818 6.31876 13.209 4.99992 15.6818 3.68108 17.0007 1.20825ZM8.00065 4.33325 10.6673 9.33325 15.6673 11.9999 10.6673 14.6666 8.00065 19.6666 5.33398 14.6666.333984 11.9999 5.33398 9.33325 8.00065 4.33325ZM19.6673 16.3333 18.0007 13.2083 16.334 16.3333 13.209 17.9999 16.334 19.6666 18.0007 22.7916 19.6673 19.6666 22.7923 17.9999 19.6673 16.3333Z"
                  ></path>
                </svg>
                <span>AI-Generated Narrative</span>
              </div>
            </div>
          </div>
          {% endif %}

          <div class="form-actions">
            {% if current_user.is_authenticated and current_user.id ==
            profile_user.id %}
            <a href="{{ url_for('add_posts') }}" class="btn btn-secondary">
              Add New Post
            </a>
            <a href="{{ url_for('add_products') }}" class="btn btn-secondary">
              Add New Product
            </a>
            {% endif %}
          </div>
        </div>

        <!-- Content Tabs -->
        <div class="content-tabs">
          <div class="tab-nav">
            <button class="tab-button active" onclick="showTab('posts')">
              {{ posts|length }} Posts
            </button>
            <button class="tab-button" onclick="showTab('products')">
              {{ products|length }} Products
            </button>
          </div>

          <div class="tab-content">
            <!-- Posts Tab -->
            <div id="posts-tab" class="tab-panel">
              {% if posts %}
              <div class="posts-grid">
                {% for post in posts %}
                <div class="post-item">
                  <button
                    class="btn say-aloud-btn"
                    onclick="sayAloud({title: '{{ post.post_title }}', artist: '{{ post.artist.name }}', price: '{{ post.price }}', description: '{{ post.description | default('No description available') }}' })"
                    title="Say Aloud"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="32"
                      height="32"
                      fill="#000000"
                      viewBox="0 0 256 256"
                    >
                      <path
                        d="M168,32V224a8,8,0,0,1-12.91,6.31L85.25,176H40a16,16,0,0,1-16-16V96A16,16,0,0,1,40,80H85.25l69.84-54.31A8,8,0,0,1,168,32Zm32,64a8,8,0,0,0-8,8v48a8,8,0,0,0,16,0V104A8,8,0,0,0,200,96Zm32-16a8,8,0,0,0-8,8v80a8,8,0,0,0,16,0V88A8,8,0,0,0,232,80Z"
                      ></path>
                    </svg>
                  </button>
                  {% if current_user.is_authenticated and current_user.id ==
                  post.artist_id %}
                  <button
                    class="delete-btn post-delete-btn"
                    onclick="if(confirm('Delete this post?')) window.location.href='{{ url_for('delete_posts', post_id=post.post_id) }}'"
                    title="Delete Post"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      width="24"
                      height="24"
                      fill="currentColor"
                    >
                      <path
                        d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM9 11V17H11V11H9ZM13 11V17H15V11H13ZM9 4V6H15V4H9Z"
                      ></path>
                    </svg>
                  </button>
                  {% endif %} {% if post.media_url %}
                  <img
                    src="{{ post.media_url }}"
                    alt="{{ post.post_title }}"
                    class="item-image"
                  />
                  {% else %}
                  <div class="item-image placeholder">
                    <i class="fas fa-image"></i>
                  </div>
                  {% endif %}
                  <div class="item-content">
                    <div class="item-actions">
                      <span class="info-value">{{ post.created_at }}</span>
                    </div>
                    <h3 class="item-title">{{ post.post_title }}</h3>
                    <p class="item-description">
                      {{ post.description[:100] }}{% if post.description|length
                      > 100 %}...{% endif %}
                    </p>
                  </div>
                  <button
                    class="share-btn"
                    onclick="copyToClipboard(window.location.host + '{{ url_for('home') }}?q={{ post.post_title }}+{{ post.artist.name }}')"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      width="24"
                      height="24"
                      fill="currentColor"
                    >
                      <path
                        d="M13 14H11C7.54202 14 4.53953 15.9502 3.03239 18.8107C3.01093 18.5433 3 18.2729 3 18C3 12.4772 7.47715 8 13 8V3L23 11L13 19V14Z"
                      ></path>
                    </svg>
                  </button>
                </div>
                {% endfor %}
              </div>
              {% else %}
              <div class="empty-state">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M5 11.1005L7 9.1005L12.5 14.6005L16 11.1005L19 14.1005V5H5V11.1005ZM4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM15.5 10C14.6716 10 14 9.32843 14 8.5C14 7.67157 14.6716 7 15.5 7C16.3284 7 17 7.67157 17 8.5C17 9.32843 16.3284 10 15.5 10Z"
                  ></path>
                </svg>
                {% if current_user.is_authenticated and current_user.id ==
                profile_user.id %}
                <h3>ADD POSTS TO START</h3>
                <p>Start sharing your artwork with the community</p>
                <a href="{{ url_for('add_posts') }}" class="btn btn-secondary">
                  Add New Post
                </a>
                {% else %}
                <h3>NO POSTS AVAILABLE</h3>
                <p>{{ profile_user.name }} has not shared any posts yet.</p>
                {% endif %}
              </div>
              {% endif %}
            </div>

            <!-- Products Tab -->
            <div id="products-tab" class="tab-panel" style="display: none">
              {% if products %}
              <div class="products-grid">
                {% for product in products %}
                <div class="product-item">
                  <button
                    class="btn say-aloud-btn"
                    onclick="sayAloud({title: '{{ product.title }}', artist: '{{ product.artist.name }}', price: '{{ product.price }}', description: '{{ product.description | default('No description available') }}' })"
                    title="Say Aloud"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="32"
                      height="32"
                      fill="#000000"
                      viewBox="0 0 256 256"
                    >
                      <path
                        d="M168,32V224a8,8,0,0,1-12.91,6.31L85.25,176H40a16,16,0,0,1-16-16V96A16,16,0,0,1,40,80H85.25l69.84-54.31A8,8,0,0,1,168,32Zm32,64a8,8,0,0,0-8,8v48a8,8,0,0,0,16,0V104A8,8,0,0,0,200,96Zm32-16a8,8,0,0,0-8,8v80a8,8,0,0,0,16,0V88A8,8,0,0,0,232,80Z"
                      ></path>
                    </svg>
                  </button>
                  <button
                    class="share-btn"
                    onclick="copyToClipboard(window.location.host + '{{ url_for('product_buy', product_id=product.product_id) }}')"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      width="24"
                      height="24"
                      fill="currentColor"
                    >
                      <path
                        d="M13 14H11C7.54202 14 4.53953 15.9502 3.03239 18.8107C3.01093 18.5433 3 18.2729 3 18C3 12.4772 7.47715 8 13 8V3L23 11L13 19V14Z"
                      ></path>
                    </svg>
                  </button>
                  {% if product.img_url %}
                  <img
                    src="{{ product.img_url }}"
                    alt="{{ product.title }}"
                    class="item-image"
                  />
                  {% else %}
                  <div class="item-image placeholder">
                    <i class="fas fa-image"></i>
                  </div>
                  {% endif %}
                  <div class="item-content">
                    <!-- Promote product button (new) -->
                    {% if current_user.id == product.artist_id %}
                    <form
                      method="post"
                      action="{{ url_for('promote_product', product_id=product.product_id) }}"
                      class="promote-form"
                    >
                      <button
                        type="submit"
                        class="btn promote-btn"
                        title="Promote Product"
                      >
                        Promote Product
                      </button>
                    </form>
                    {% endif %}
                    <h3 class="item-title">{{ product.title }}</h3>
                    <p class="item-description">
                      {{ product.description[:100] if product.description else
                      '' }}{% if product.description and
                      product.description|length > 100 %}...{% endif %}
                    </p>
                    <div class="item-price">Rs.{{ product.price }}</div>
                    <div class="item-actions">
                      <a
                        href="{{ url_for('product_buy', product_id=product.product_id) }}"
                        class="btn btn-primary"
                      >
                        View
                      </a>
                      {% if current_user.is_authenticated and current_user.id ==
                      product.artist_id %}
                      <button
                        class="delete-btn"
                        onclick="if(confirm('Delete this product?')) window.location.href='{{ url_for('delete_products', product_id=product.product_id) }}'"
                        title="Delete Product"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 24 24"
                          width="24"
                          height="24"
                          fill="currentColor"
                        >
                          <path
                            d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM9 11V17H11V11H9ZM13 11V17H15V11H13ZM9 4V6H15V4H9Z"
                          ></path>
                        </svg>
                      </button>
                      {% endif %}
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
              {% else %}
              <div class="empty-state">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M12 1L21.5 6.5V17.5L12 23L2.5 17.5V6.5L12 1ZM4.5 7.65311V7.65788L12 12V20.689L19.5 16.3469V7.65311L12 3.311L4.5 7.65311Z"
                  ></path>
                </svg>
                {% if current_user.is_authenticated and current_user.id ==
                profile_user.id %}
                <h3>ADD PRODUCTS TO START</h3>
                <p>Start selling your artwork in the marketplace</p>
                <a
                  href="{{ url_for('add_products') }}"
                  class="btn btn-secondary"
                >
                  Add New Product
                </a>
                {% else %}
                <h3>NO PRODUCTS AVAILABLE</h3>
                <p>{{ profile_user.name }} has not added any products yet.</p>
                {% endif %}
              </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="google_translate_element" class="translate-element"></div>
    <button
      id="translateButton"
      onclick="googleTranslateElementInit()"
      class="translate-btn"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
      >
        <path
          d="M18.5 10L22.9 21H20.745L19.544 18H15.454L14.255 21H12.101L16.5 10H18.5ZM10 2V4H16V6L14.0322 6.0006C13.2425 8.36616 11.9988 10.5057 10.4115 12.301C11.1344 12.9457 11.917 13.5176 12.7475 14.0079L11.9969 15.8855C10.9237 15.2781 9.91944 14.5524 8.99961 13.7249C7.21403 15.332 5.10914 16.5553 2.79891 17.2734L2.26257 15.3442C4.2385 14.7203 6.04543 13.6737 7.59042 12.3021C6.46277 11.0281 5.50873 9.57985 4.76742 8.00028L7.00684 8.00037C7.57018 9.03885 8.23979 10.0033 8.99967 10.877C10.2283 9.46508 11.2205 7.81616 11.9095 6.00101L2 6V4H8V2H10ZM17.5 12.8852L16.253 16H18.745L17.5 12.8852Z"
        ></path>
      </svg>
    </button>

    <script>
          function toggleMenu(e) {
        e?.stopPropagation?.();
        const menu = document.getElementById("mobileMenu");
        const now = menu.style.display === "flex" ? "none" : "flex";
        menu.style.display = now;
            if (now === "flex")
              document.getElementById("searchBelow").classList.remove("open");
      }

          function toggleSearch() {
        const bar = document.getElementById("searchBelow");
        bar.classList.toggle("open");
        const menu = document.getElementById("mobileMenu");
            if (menu.style.display === "flex") menu.style.display = "none";
            if (bar.classList.contains("open")) {
              requestAnimationFrame(() =>
                document.getElementById("globalSearchInput").focus()
              );
        }
      }

      // Highlight active nav link
          document.addEventListener("DOMContentLoaded", function () {
            const path = window.location.pathname.split("/").pop();
            document
              .querySelectorAll(".nav-center a, .mobile-menu a")
              .forEach((link) => {
                if (link.getAttribute("href") === path) {
                  link.classList.add("active");
          } else {
                  link.classList.remove("active");
          }
        });
      });

          function showTab(tabName) {
            // Hide all tab panels
            const tabPanels = document.querySelectorAll(".tab-panel");
            tabPanels.forEach((panel) => (panel.style.display = "none"));

            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll(".tab-button");
            tabButtons.forEach((button) => button.classList.remove("active"));

            // Show selected tab panel
            document.getElementById(tabName + "-tab").style.display = "block";

            // Add active class to clicked button
            event.target.classList.add("active");
          }

          function sayAloud(text) {
            const message = new SpeechSynthesisUtterance();
            message.text = `The title of the artwork is ${text.title}. It is created by ${text.artist}. The price of the artwork is Rs.${text.price}. The description says it is ${text.description}.`;
            window.speechSynthesis.speak(message); // Start speaking
          }

          async function copyToClipboard(textToCopy) {
            try {
              await navigator.clipboard.writeText(textToCopy);
              alert("Text copied to clipboard");
            } catch (err) {
              alert("Failed to copy text: " + err);
            }
          }

       // Text-to-Speech functionality
       let speechSynthesis = window.speechSynthesis;
       let currentUtterance = null;
       let isPlaying = false;

       // Function to detect current language from Google Translate
       function getCurrentLanguage() {
         // Method 1: Check if page has been translated by Google Translate
         const body = document.body;
         if (body.classList.contains('translated-ltr') || body.classList.contains('translated-rtl')) {
           // Try to get language from Google Translate's iframe
           const translateFrame = document.querySelector('iframe[src*="translate.google"]');
           if (translateFrame) {
             try {
               const frameDoc = translateFrame.contentDocument || translateFrame.contentWindow.document;
               const langSelect = frameDoc.querySelector('select');
               if (langSelect && langSelect.value) {
                 return langSelect.value;
               }
             } catch (e) {
               // Cross-origin access blocked
             }
           }

           // Try to detect from URL parameters
           const urlParams = new URLSearchParams(window.location.search);
           const lang = urlParams.get('hl');
           if (lang) return lang;

           // Check for Google Translate's language indicator
           const langIndicator = document.querySelector('[data-google-lang]');
           if (langIndicator) {
             return langIndicator.getAttribute('data-google-lang');
           }

           // Try to detect from Google Translate's global state
           if (window.google && window.google.translate && window.google.translate.TranslateElement) {
             const translateElement = document.querySelector('.goog-te-combo');
             if (translateElement && translateElement.value) {
               return translateElement.value;
             }
           }
         }

         // Method 2: Check for Google Translate's language selector
         const langSelect = document.querySelector('.goog-te-combo');
         if (langSelect && langSelect.value && langSelect.value !== 'en') {
           return langSelect.value;
         }

         // Method 3: Check for Google Translate's banner frame
         const googleBanner = document.querySelector('.goog-te-banner-frame');
         if (googleBanner) {
           const bannerSelect = googleBanner.querySelector('select');
           if (bannerSelect && bannerSelect.value) {
             return bannerSelect.value;
           }
         }

         // Default to English if no translation detected
         return 'en';
       }

       // Function to detect language from Google Translate's actual implementation
       function detectGoogleTranslateLanguage() {
         // Check if Google Translate is active
         const body = document.body;
         if (body.classList.contains('translated-ltr') || body.classList.contains('translated-rtl')) {
           // Try to get language from Google Translate's iframe
           const translateFrame = document.querySelector('iframe[src*="translate.google"]');
           if (translateFrame) {
             try {
               const frameDoc = translateFrame.contentDocument || translateFrame.contentWindow.document;
               const langSelect = frameDoc.querySelector('select');
               if (langSelect && langSelect.value) {
                 return langSelect.value;
               }
             } catch (e) {
               // Cross-origin access blocked
             }
           }

           // Try to detect from URL parameters
           const urlParams = new URLSearchParams(window.location.search);
           const lang = urlParams.get('hl');
           if (lang) return lang;

           // Check for Google Translate's language indicator
           const langIndicator = document.querySelector('[data-google-lang]');
           if (langIndicator) {
             return langIndicator.getAttribute('data-google-lang');
           }

           // Try to detect from Google Translate's global state
           if (window.google && window.google.translate && window.google.translate.TranslateElement) {
             const translateElement = document.querySelector('.goog-te-combo');
             if (translateElement && translateElement.value) {
               return translateElement.value;
             }
           }
         }

         // Check for Google Translate's language selector
         const langSelect = document.querySelector('.goog-te-combo');
         if (langSelect && langSelect.value && langSelect.value !== 'en') {
           return langSelect.value;
         }

         // Check for Google Translate's banner frame
         const googleBanner = document.querySelector('.goog-te-banner-frame');
         if (googleBanner) {
           const bannerSelect = googleBanner.querySelector('select');
           if (bannerSelect && bannerSelect.value) {
             return bannerSelect.value;
           }
         }

         // Default to English if no translation detected
         return 'en';
       }

       // Function to get the actual translated text
       function getTranslatedText() {
         const narrativeElement = document.getElementById('narrativeText');
         if (!narrativeElement) return '';

         // Check if the page has been translated
         const body = document.body;
         if (body.classList.contains('translated-ltr') || body.classList.contains('translated-rtl')) {
           // Return the translated text that's currently displayed
           return narrativeElement.textContent || narrativeElement.innerText;
         }

         // Return original text if not translated
         return narrativeElement.textContent || narrativeElement.innerText;
       }

           function speakNarrative() {
             const narrativeText = document.getElementById('narrativeText');
             const speakBtn = document.getElementById('speakNarrative');

             if (!narrativeText) return;

             // Stop any current speech
             if (isPlaying) {
               stopSpeech();
               return;
             }

         // Get the actual translated text
         const translatedText = getTranslatedText();

         // Create enhanced narrative for speech
         const artistName = "{{ profile_user.name if profile_user else current_user.name }}";
         const postsCount = {{ posts|length }};
         const productsCount = {{ products|length }};
         const totalWorks = postsCount + productsCount;
         const location = "{{ profile_user.location if profile_user else current_user.location }}";

         const enhancedNarrative = `${translatedText} This collection features ${totalWorks} unique works, including ${postsCount} community posts and ${productsCount} marketplace products, each telling a part of ${artistName}'s creative story.`;

             // Create utterance
             currentUtterance = new SpeechSynthesisUtterance(enhancedNarrative);

             // Configure voice settings
             currentUtterance.rate = 0.9;
             currentUtterance.pitch = 1.0;
             currentUtterance.volume = 0.8;

         // Detect current language from Google Translate
         const currentLang = detectGoogleTranslateLanguage();
         console.log('Detected language:', currentLang);

         // Try to use a pleasant voice in the current language
         const voices = speechSynthesis.getVoices();
         console.log('Available voices:', voices.map(v => `${v.name} (${v.lang})`));

         const preferredVoice = voices.find(function(voice) {
           return voice.lang.startsWith(currentLang) &&
             (voice.name.includes('Google') || voice.name.includes('Microsoft') || voice.name.includes('Samantha') || voice.name.includes('Natural'));
         });

         // Fallback to any voice in the current language
         const fallbackVoice = voices.find(function(voice) {
           return voice.lang.startsWith(currentLang);
         });

         if (preferredVoice) {
           currentUtterance.voice = preferredVoice;
           console.log('Using preferred voice:', preferredVoice.name);
         } else if (fallbackVoice) {
           currentUtterance.voice = fallbackVoice;
           console.log('Using fallback voice:', fallbackVoice.name);
         } else {
           console.log('No voice found for language:', currentLang);
         }

         // Set language for the utterance
         currentUtterance.lang = currentLang;

             // Event handlers
             currentUtterance.onstart = function() {
               isPlaying = true;
               speakBtn.classList.add('playing');
               speakBtn.innerHTML = '<i class="fa-solid fa-volume-xmark"></i>';
             };

             currentUtterance.onend = function() {
               stopSpeech();
             };

         currentUtterance.onerror = function(event) {
           console.error('Speech synthesis error:', event.error);
           stopSpeech();
         };

             // Start speaking
             speechSynthesis.speak(currentUtterance);
           }

           function stopSpeech() {
             if (currentUtterance) {
               speechSynthesis.cancel();
             }

             isPlaying = false;
             const speakBtn = document.getElementById('speakNarrative');

             if (speakBtn) {
               speakBtn.classList.remove('playing');
               speakBtn.innerHTML = '<i class="fa-solid fa-volume-high"></i>';
             }
           }

       // Event listeners
       document.addEventListener('DOMContentLoaded', function() {
         const speakBtn = document.getElementById('speakNarrative');

         if (speakBtn) {
           speakBtn.addEventListener('click', speakNarrative);
         }

         // Listen for Google Translate events
         const observer = new MutationObserver(function(mutations) {
           mutations.forEach(function(mutation) {
             if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
               const target = mutation.target;
               if (target === document.body &&
                   (target.classList.contains('translated-ltr') || target.classList.contains('translated-rtl'))) {
                 console.log('Page translated, language detection updated');
               }
             }
           });
         });

         // Start observing
         observer.observe(document.body, {
           attributes: true,
           attributeFilter: ['class']
         });

         // Also listen for Google Translate's language change events
         if (window.google && window.google.translate) {
           window.google.translate.TranslateElement.prototype.onLanguageChange = function() {
             console.log('Google Translate language changed');
           };
         }

         // Override Google Translate's language change function
         if (window.google && window.google.translate) {
           const originalOnLanguageChange = window.google.translate.TranslateElement.prototype.onLanguageChange;
           window.google.translate.TranslateElement.prototype.onLanguageChange = function() {
             console.log('Google Translate language changed - intercepted');
             if (originalOnLanguageChange) {
               originalOnLanguageChange.call(this);
             }
           };
         }

         // Add a more direct approach - listen for clicks on Google Translate elements
         document.addEventListener('click', function(event) {
           if (event.target.closest('.goog-te-combo')) {
             setTimeout(function() {
               console.log('Google Translate combo clicked, checking language...');
               const langSelect = document.querySelector('.goog-te-combo');
               if (langSelect && langSelect.value) {
                 console.log('Current Google Translate language:', langSelect.value);
               }
             }, 100);
           }
         });
       });
    </script>
    <script
      type="text/javascript"
      src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"
    ></script>
    <script type="text/javascript">
      function googleTranslateElementInit() {
        new google.translate.TranslateElement(
          {
            pageLanguage: "en", // Set your website's default language
            includedLanguages:
              "en,hi,bi,ta,te,mr,gu,kn,ml,pa,ur,es,fr,de,zh,ja,ko", // Optional: Specify languages to include in the dropdown
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE, // Optional: Customize widget layout
          },
          "google_translate_element"
        );
      }
    </script>
  </body>
</html>
