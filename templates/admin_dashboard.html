<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Clyst</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
    <style>
      .admin-container {
        max-width: 1200px;
        margin: 20px auto;
      }

      .admin-header {
        margin: 20px;
      }

      .admin-header h1 {
        margin: 0 0 4px 0;
        padding: 0;
        color: var(--text);
        font-size: 40px;
        font-weight: 500;
      }

      .admin-header p {
        margin: 0;
        color: var(--muted);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 8px;
        margin-bottom: 24px;
        padding: 0 20px;
      }

      .stat-card {
        background: var(--card);
        padding: 20px;
        border-radius: 12px;
        border: 1px solid var(--border);
      }

      .stat-card h3 {
        margin: 0 0 2px 0;
        color: var(--muted);
        font-size: 14px;
        font-weight: 500;
        text-transform: uppercase;
      }

      .stat-card .number {
        font-size: 40px;
        font-weight: 500;
        color: var(--text);
      }

      .stat-card.pending {
        border-color: light-dark(#ff9800, #ff9800);
      }

      .stat-card.pending .number {
        color: light-dark(#ff9800, #ff9800);
      }

      .content-section {
        margin: 0 20px 20px 20px;
        border-radius: 12px;
        border: 1px solid var(--border);
        overflow: hidden;
      }

      .content-section h2 {
        padding: 16px 20px;
        background: var(--card);
        color: var(--text);
        font-size: 28px;
        font-weight: 500;
      }

      .content-list {
        display: flex;
        flex-direction: column;
      }

      .content-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 20px;
        padding: 12px 20px;
        background: var(--bg);
        border-bottom: 1px solid var(--border);
      }

      .content-item:first-child{
        border-top: 1px solid var(--border);
      }

      .content-item:last-child{
        border-bottom: none;
      }

      .content-item:hover{
        cursor: pointer;
        background: var(--border);
      }

      .content-info {
        flex: 1;
      }

      .content-info .title {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 4px;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 4px;
      }

      .content-info .meta {
        font-size: 13px;
        color: var(--muted);
      }

      .content-actions {
        display: flex;
        gap: 8px;
      }

      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
      }

      .btn-danger {
        width: fit-content;
        background: light-dark(#dc3545, #c82333);
        color: white;
      }

      .btn-success {
        background: light-dark(#28a745, #1e7e34);
        color: white;
      }

      .btn-success:hover {
        background: light-dark(#218838, #1c6e2e);
      }

      .btn-view {
        background: var(--accent);
        color: light-dark(white, black);
      }

      .btn-view:hover {
        opacity: 0.8;
      }

      .admin-nav {
        display: flex;
        gap: 12px;
        margin: 0 20px 20px 20px;
      }

      .admin-nav a {
        padding: 10px 20px;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 8px;
        color: var(--text);
        text-decoration: none;
        transition: all 0.2s;
      }

      .admin-nav a:hover {
        background: var(--accent);
        color: light-dark(white, black);
      }

      .verified-badge {
        width: fit-content;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        gap: 4px;
        padding: 2px 8px;
        background: light-dark(#28a745, #1e7e34);
        color: white;
        border-radius: 4px;
        font-size: 11px;
        margin-left: 8px;
      }

      .verified-badge svg{
        width: 14px;
      }

      .price{
        padding: 4px 8px;
        font-size: 14px;
      }

      .admin-badge {
        width: fit-content;
        height: fit-content;
        background: light-dark(#007bff, #0056b3);
      }
    </style>
  </head>
  <body>
    <div class="admin-container">
      <div class="admin-header">
        <h1>Admin Dashboard</h1>
        <p>Welcome {{ current_user.name }}, the admin</p>
      </div>

      <div class="admin-nav">
        <a href="{{ url_for('admin_dashboard') }}">Dashboard</a>
        <a href="{{ url_for('admin_users') }}">Manage Users</a>
        <a href="{{ url_for('home') }}">Back to Site</a>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <h3>Total Users</h3>
          <div class="number">{{ stats.users }}</div>
        </div>
        <div class="stat-card">
          <h3>Total Posts</h3>
          <div class="number">{{ stats.posts }}</div>
        </div>
        <div class="stat-card">
          <h3>Total Products</h3>
          <div class="number">{{ stats.products }}</div>
        </div>
        <div class="stat-card">
          <h3>Reviews</h3>
          <div class="number">{{ stats.reviews }}</div>
        </div>
        <div class="stat-card">
          <h3>Comments</h3>
          <div class="number">{{ stats.comments }}</div>
        </div>
        <div class="stat-card pending">
          <h3>Pending Verifications</h3>
          <div class="number">{{ stats.pending_verifications }}</div>
        </div>
      </div>

      <div class="content-section">
        <h2>Recent Posts</h2>
        <div class="content-list">
          {% for post in recent_posts %}
          <div class="content-item" onclick='location.href="{{ url_for('home') }}#post-{{ post.post_id }}"'>
            <div class="content-info">
              <div class="title">{{ post.post_title }}</div>
              <div class="meta">
                {{ post.artist.name }} • {{ post.created_at }}
              </div>
            </div>
            <div class="content-actions">
              <button
                class="btn btn-danger"
                onclick="deletePost({{ post.post_id }})"
              >
                Delete
              </button>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <div class="content-section">
        <h2>Recent Products</h2>
        <div class="content-list">
          {% for product in recent_products %}
          <div class="content-item" onclick='location.href="{{ url_for('product_buy', product_id=product.product_id) }}"'>
            <div class="content-info">
              <div class="title">
                {{ product.title }} <span class="verified-badge price">Rs. {{ product.price }}</span>
              </div>
              <div class="meta">
                {{ product.artist.name }} • {{ product.created_at }}
              </div>
            </div>
            <div class="content-actions">
              <button
                class="btn btn-danger"
                onclick="deleteProduct({{ product.product_id }})"
              >
                Delete
              </button>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <div class="content-section">
        <h2>Recent Users</h2>
        <div class="content-list">
          {% for user in recent_users %}
          <div class="content-item" onclick='location.href="{{ url_for('view_profile', user_id=user.id) }}"'>
            <div class="content-info">
              <div class="title">
                {{ user.name }} {% if user.is_verified %}
                <span class="verified-badge"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10.007 2.10377C8.60544 1.65006 7.08181 2.28116 6.41156 3.59306L5.60578 5.17023C5.51004 5.35763 5.35763 5.51004 5.17023 5.60578L3.59306 6.41156C2.28116 7.08181 1.65006 8.60544 2.10377 10.007L2.64923 11.692C2.71404 11.8922 2.71404 12.1078 2.64923 12.308L2.10377 13.993C1.65006 15.3946 2.28116 16.9182 3.59306 17.5885L5.17023 18.3942C5.35763 18.49 5.51004 18.6424 5.60578 18.8298L6.41156 20.407C7.08181 21.7189 8.60544 22.35 10.007 21.8963L11.692 21.3508C11.8922 21.286 12.1078 21.286 12.308 21.3508L13.993 21.8963C15.3946 22.35 16.9182 21.7189 17.5885 20.407L18.3942 18.8298C18.49 18.6424 18.6424 18.49 18.8298 18.3942L20.407 17.5885C21.7189 16.9182 22.35 15.3946 21.8963 13.993L21.3508 12.308C21.286 12.1078 21.286 11.8922 21.3508 11.692L21.8963 10.007C22.35 8.60544 21.7189 7.08181 20.407 6.41156L18.8298 5.60578C18.6424 5.51004 18.49 5.35763 18.3942 5.17023L17.5885 3.59306C16.9182 2.28116 15.3946 1.65006 13.993 2.10377L12.308 2.64923C12.1078 2.71403 11.8922 2.71404 11.692 2.64923L10.007 2.10377ZM6.75977 11.7573L8.17399 10.343L11.0024 13.1715L16.6593 7.51465L18.0735 8.92886L11.0024 15.9999L6.75977 11.7573Z"></path></svg> Verified</span>
                {% endif %} {% if user.is_admin %}
                <span class="verified-badge admin-badge">Admin</span>
                {% endif %}
              </div>
              <div class="meta">
                {{ user.email }} • {{ user.location or 'No location' }}
              </div>
            </div>
            <div class="content-actions">
              {% if not user.is_admin and user.id != current_user.id %}
              <button
                class="btn btn-danger"
                onclick="banUser({{ user.id }}, '{{ user.name }}')"
              >
                Ban User
              </button>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <script>
      async function deletePost(postId) {
        if (!confirm("Are you sure you want to delete this post?")) return;

        try {
          const response = await fetch(`/admin/delete_post/${postId}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
          });

          const data = await response.json();
          if (data.success) {
            alert(data.message);
            location.reload();
          } else {
            alert("Error: " + data.message);
          }
        } catch (error) {
          alert("Failed to delete post");
          console.error(error);
        }
      }

      async function deleteProduct(productId) {
        if (!confirm("Are you sure you want to delete this product?")) return;

        try {
          const response = await fetch(`/admin/delete_product/${productId}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
          });

          const data = await response.json();
          if (data.success) {
            alert(data.message);
            location.reload();
          } else {
            alert("Error: " + data.message);
          }
        } catch (error) {
          alert("Failed to delete product");
          console.error(error);
        }
      }

      async function banUser(userId, userName) {
        if (
          !confirm(
            `Are you sure you want to ban ${userName}? This will delete their account and all content.`
          )
        )
          return;

        try {
          const response = await fetch(`/admin/ban_user/${userId}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
          });

          const data = await response.json();
          if (data.success) {
            alert(data.message);
            location.reload();
          } else {
            alert("Error: " + data.message);
          }
        } catch (error) {
          alert("Failed to ban user");
          console.error(error);
        }
      }
    </script>
  </body>
</html>
